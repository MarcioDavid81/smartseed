generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  id                 String                @id @default(uuid())
  name               String
  createdAt          DateTime              @default(now())
  plan               Plan?                 @default(BASIC)
  accountsPayable    AccountPayable[]
  accountsReceivable AccountReceivable[]
  applications       Application[]
  beneficiations     Beneficiation[]
  buys               Buy[]
  consumptionsExit   ConsumptionExit[]
  cultivars          Cultivar[]
  customers          Customer[]
  farms              Farm[]
  fuelPurchases      FuelPurchase[]
  fuelTanks          FuelTank[]
  harvests           Harvest[]
  industryDeposits   IndustryDeposit[]
  industryHarvests   IndustryHarvest[]
  industrySales      IndustrySale[]
  industryStockAdjustments IndustryStockAdjustment[]
  industryStocks     IndustryStock[]
  industryTransfers  IndustryTransfer[]
  transporters       IndustryTransporter[]
  machines           Machine[]
  maintenances       Maintenance[]
  products           Product[]
  productStocks      ProductStock[]
  productionCycles   ProductionCycle[]
  purchases          Purchase[]
  refuels            Refuel[]
  salesExit          SaleExit[]
  stockAdjustments   SeedStockAdjustment[]
  talhoes            Talhao[]
  transfers          TransferExit[]
  users              User[]
}

model Farm {
  id              String         @id @default(uuid())
  name            String
  area            Float
  companyId       String
  createdAt       DateTime       @default(now())
  company         Company        @relation(fields: [companyId], references: [id])
  productStocks   ProductStock[]
  purchases       Purchase[]
  talhoes         Talhao[]
  destTransfers   TransferExit[] @relation("DestFarm")
  originTransfers TransferExit[] @relation("OriginFarm")
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  companyId String
  createdAt DateTime @default(now())
  imageUrl  String?
  role      Role?    @default(USER)
  company   Company  @relation(fields: [companyId], references: [id])
}

model Customer {
  id                 String              @id @default(uuid())
  name               String
  email              String?
  adress             String?
  city               String?
  state              String?
  phone              String?
  cpf_cnpj           String?             @unique
  companyId          String
  createdAt          DateTime            @default(now())
  accountsPayable    AccountPayable[]
  accountsReceivable AccountReceivable[]
  buys               Buy[]
  company            Company             @relation(fields: [companyId], references: [id])
  fuelPurchases      FuelPurchase[]
  industrySales      IndustrySale[]
  maintenances       Maintenance[]
  purchases          Purchase[]
  sales              SaleExit[]
}

model Talhao {
  id               String            @id @default(cuid())
  name             String
  area             Float
  companyId        String
  farmId           String
  createdAt        DateTime          @default(now())
  applications     Application[]
  consumptionsExit ConsumptionExit[]
  cycles           CycleTalhao[]
  harvests         Harvest[]
  industryHarvests IndustryHarvest[]
  company          Company           @relation(fields: [companyId], references: [id])
  farm             Farm              @relation(fields: [farmId], references: [id])
}

model Cultivar {
  id               String                @id @default(cuid())
  name             String
  product          ProductType
  createdAt        DateTime              @default(now())
  companyId        String
  stock            Float                 @default(0)
  status           CultivarStatus        @default(BENEFICIANDO)
  beneficiations   Beneficiation[]
  buys             Buy[]
  consumptionsExit ConsumptionExit[]
  company          Company               @relation(fields: [companyId], references: [id])
  harvests         Harvest[]
  saleExit         SaleExit[]
  stockAdjustments SeedStockAdjustment[]
}

model Harvest {
  id         String           @id @default(cuid())
  cultivarId String
  date       DateTime
  quantityKg Float
  talhaoId   String
  companyId  String
  notes      String?
  createdAt  DateTime         @default(now())
  type       OperationType    @default(Colheita)
  cycleId    String?
  company    Company          @relation(fields: [companyId], references: [id])
  cultivar   Cultivar         @relation(fields: [cultivarId], references: [id])
  cycle      ProductionCycle? @relation(fields: [cycleId], references: [id])
  talhao     Talhao           @relation(fields: [talhaoId], references: [id])
}

model Buy {
  id               String            @id @default(cuid())
  cultivarId       String
  date             DateTime
  quantityKg       Float
  notes            String?
  companyId        String
  createdAt        DateTime          @default(now())
  customerId       String
  invoice          String
  totalPrice       Float
  unityPrice       Float
  type             OperationType     @default(Compra)
  cycleId          String?
  dueDate          DateTime?
  paymentCondition PaymentCondition?
  fileUrl          String?
  accountPayable   AccountPayable?
  company          Company           @relation(fields: [companyId], references: [id])
  cultivar         Cultivar          @relation(fields: [cultivarId], references: [id])
  customer         Customer          @relation(fields: [customerId], references: [id], onDelete: Restrict)
  cycle            ProductionCycle?  @relation(fields: [cycleId], references: [id])
}

model Beneficiation {
  id            String           @id @default(cuid())
  date          DateTime
  notes         String?
  createdAt     DateTime         @default(now())
  companyId     String
  cultivarId    String
  quantityKg    Float
  type          OperationType    @default(Descarte)
  cycleId       String?
  destinationId String?
  company       Company          @relation(fields: [companyId], references: [id])
  cultivar      Cultivar         @relation(fields: [cultivarId], references: [id])
  cycle         ProductionCycle? @relation(fields: [cycleId], references: [id])
  destination   IndustryDeposit? @relation(fields: [destinationId], references: [id])
}

model ConsumptionExit {
  id         String           @id @default(cuid())
  cultivarId String
  date       DateTime
  quantityKg Float
  notes      String?
  companyId  String
  createdAt  DateTime         @default(now())
  type       OperationType    @default(Plantio)
  cycleId    String?
  talhaoId   String
  company    Company          @relation(fields: [companyId], references: [id])
  cultivar   Cultivar         @relation(fields: [cultivarId], references: [id])
  cycle      ProductionCycle? @relation(fields: [cycleId], references: [id])
  talhao     Talhao           @relation(fields: [talhaoId], references: [id])
}

model SaleExit {
  id                String             @id @default(cuid())
  cultivarId        String
  date              DateTime
  quantityKg        Float
  customerId        String?
  invoiceNumber     String?
  saleValue         Float?
  notes             String?
  companyId         String
  createdAt         DateTime           @default(now())
  type              OperationType      @default(Venda)
  cycleId           String?
  dueDate           DateTime?
  paymentCondition  PaymentCondition?
  fileUrl           String?
  accountReceivable AccountReceivable?
  company           Company            @relation(fields: [companyId], references: [id])
  cultivar          Cultivar           @relation(fields: [cultivarId], references: [id])
  customer          Customer?          @relation(fields: [customerId], references: [id], onDelete: Restrict)
  cycle             ProductionCycle?   @relation(fields: [cycleId], references: [id])
}

model SeedStockAdjustment {
  id         String        @id @default(cuid())
  date       DateTime
  quantityKg Float
  cultivarId String
  companyId  String
  notes      String?
  createdAt  DateTime      @default(now())
  type       OperationType @default(Ajuste)
  company    Company       @relation(fields: [companyId], references: [id])
  cultivar   Cultivar      @relation(fields: [cultivarId], references: [id])
}

model ProductionCycle {
  id                String             @id @default(cuid())
  name              String
  startDate         DateTime
  endDate           DateTime
  companyId         String
  createdAt         DateTime           @default(now())
  isActive          Boolean            @default(false)
  productType       ProductType?
  forceMigration    Int?               @default(1)
  applications      Application[]
  beneficiations    Beneficiation[]
  buys              Buy[]
  consumptionsExit  ConsumptionExit[]
  talhoes           CycleTalhao[]
  harvests          Harvest[]
  industryHarvests  IndustryHarvest[]
  industrySales     IndustrySale[]
  industryTransfers IndustryTransfer[]
  company           Company            @relation(fields: [companyId], references: [id])
  purchases         Purchase[]
  salesExit         SaleExit[]
  transfers         TransferExit[]
}

model CycleTalhao {
  id        String          @id @default(cuid())
  cycleId   String
  talhaoId  String
  createdAt DateTime        @default(now())
  cycle     ProductionCycle @relation(fields: [cycleId], references: [id])
  talhao    Talhao          @relation(fields: [talhaoId], references: [id])
}

model Product {
  id          String         @id @default(cuid())
  name        String
  description String?
  class       ProductClass
  unit        Unit
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  companyId   String
  company     Company        @relation(fields: [companyId], references: [id])
  stocks      ProductStock[]
  purchases   Purchase[]
  transfers   TransferExit[]
}

model ProductStock {
  id           String        @id @default(cuid())
  productId    String
  farmId       String
  stock        Float         @default(0)
  companyId    String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  applications Application[]
  company      Company       @relation(fields: [companyId], references: [id])
  farm         Farm          @relation(fields: [farmId], references: [id])
  product      Product       @relation(fields: [productId], references: [id])

  @@unique([productId, farmId])
}

model Purchase {
  id               String              @id @default(cuid())
  productId        String
  date             DateTime
  quantity         Float
  invoiceNumber    String
  unitPrice        Float
  totalPrice       Float
  customerId       String
  notes            String?
  companyId        String
  type             InsumoOperationType @default(COMPRA)
  cycleId          String?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  farmId           String
  dueDate          DateTime?
  paymentCondition PaymentCondition?
  fileUrl          String?
  accountPayable   AccountPayable?
  company          Company             @relation(fields: [companyId], references: [id])
  customer         Customer            @relation(fields: [customerId], references: [id], onDelete: Restrict)
  cycle            ProductionCycle?    @relation(fields: [cycleId], references: [id])
  farm             Farm                @relation(fields: [farmId], references: [id])
  product          Product             @relation(fields: [productId], references: [id])
}

model TransferExit {
  id           String              @id @default(cuid())
  date         DateTime
  productId    String
  quantity     Float
  companyId    String
  type         InsumoOperationType @default(TRANSFERENCIA)
  cycleId      String?
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  destFarmId   String
  originFarmId String
  company      Company             @relation(fields: [companyId], references: [id])
  cycle        ProductionCycle?    @relation(fields: [cycleId], references: [id])
  destFarm     Farm                @relation("DestFarm", fields: [destFarmId], references: [id])
  originFarm   Farm                @relation("OriginFarm", fields: [originFarmId], references: [id])
  product      Product             @relation(fields: [productId], references: [id])
}

model Application {
  id             String              @id @default(cuid())
  date           DateTime
  quantity       Float
  talhaoId       String
  notes          String?
  companyId      String
  type           InsumoOperationType @default(APLICACAO)
  cycleId        String?
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  productStockId String
  company        Company             @relation(fields: [companyId], references: [id])
  cycle          ProductionCycle?    @relation(fields: [cycleId], references: [id])
  productStock   ProductStock        @relation(fields: [productStockId], references: [id])
  talhao         Talhao              @relation(fields: [talhaoId], references: [id])
}

model AccountPayable {
  id             String        @id @default(cuid())
  description    String
  amount         Float
  dueDate        DateTime
  paymentDate    DateTime?
  status         AccountStatus @default(PENDING)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  companyId      String
  buyId          String?       @unique
  purchaseId     String?       @unique
  customerId     String
  fuelPurchaseId String?       @unique
  maintenanceId  String?       @unique
  buy            Buy?          @relation(fields: [buyId], references: [id])
  company        Company       @relation(fields: [companyId], references: [id])
  customer       Customer      @relation(fields: [customerId], references: [id], onDelete: Restrict)
  fuelPurchase   FuelPurchase? @relation(fields: [fuelPurchaseId], references: [id])
  maintenance    Maintenance?  @relation(fields: [maintenanceId], references: [id])
  purchase       Purchase?     @relation(fields: [purchaseId], references: [id])
}

model AccountReceivable {
  id             String        @id @default(cuid())
  description    String
  amount         Float
  dueDate        DateTime
  receivedDate   DateTime?
  status         AccountStatus @default(PENDING)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  companyId      String
  saleExitId     String?       @unique
  customerId     String
  industrySaleId String?       @unique
  company        Company       @relation(fields: [companyId], references: [id])
  customer       Customer      @relation(fields: [customerId], references: [id], onDelete: Restrict)
  industrySale   IndustrySale? @relation(fields: [industrySaleId], references: [id])
  saleExit       SaleExit?     @relation(fields: [saleExitId], references: [id])
}

model IndustryDeposit {
  id               String             @id @default(cuid())
  name             String
  companyId        String
  createdAt        DateTime           @default(now())
  beneficiations   Beneficiation[]
  company          Company            @relation(fields: [companyId], references: [id])
  industryHarvests IndustryHarvest[]
  industrySales    IndustrySale[]
  industryStockAdjustments IndustryStockAdjustment[]
  industryStocks   IndustryStock[]
  transfersFrom    IndustryTransfer[] @relation("FromDeposit")
  transfersTo      IndustryTransfer[] @relation("ToDeposit")
}

model IndustryStock {
  id                String          @id @default(cuid())
  industryDepositId String
  quantity          Decimal         @db.Decimal(12, 2)
  companyId         String
  product           ProductType
  company           Company         @relation(fields: [companyId], references: [id])
  industryDeposit   IndustryDeposit @relation(fields: [industryDepositId], references: [id])

  @@unique([product, industryDepositId], name: "product_industryDepositId")
}

model IndustryTransfer {
  id            String           @id @default(cuid())
  date          DateTime         @default(now())
  product       ProductType
  fromDepositId String
  toDepositId   String
  quantity      Decimal          @db.Decimal(12, 2)
  document      String?
  observation   String?
  companyId     String
  cycleId       String?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  company       Company          @relation(fields: [companyId], references: [id])
  cycle         ProductionCycle? @relation(fields: [cycleId], references: [id])
  fromDeposit   IndustryDeposit  @relation("FromDeposit", fields: [fromDepositId], references: [id])
  toDeposit     IndustryDeposit  @relation("ToDeposit", fields: [toDepositId], references: [id])
}

model IndustryTransporter {
  id               String            @id @default(cuid())
  name             String
  fantasyName      String?
  cpf_cnpj         String?           @unique
  adress           String?
  city             String?
  state            String?
  phone            String?
  email            String?
  companyId        String
  industryHarvests IndustryHarvest[]
  industrySales    IndustrySale[]
  company          Company           @relation(fields: [companyId], references: [id])
}

model IndustryHarvest {
  id                    String               @id @default(cuid())
  date                  DateTime
  talhaoId              String
  industryDepositId     String
  industryTransporterId String?
  truckPlate            String?
  weightBt              Decimal              @db.Decimal(12, 2)
  weightTr              Decimal              @db.Decimal(12, 2)
  weightSubLiq          Decimal              @db.Decimal(12, 2)
  humidity_percent      Decimal              @db.Decimal(5, 2)
  humidity_discount     Decimal              @db.Decimal(12, 2)
  humidity_kg           Decimal              @db.Decimal(12, 2)
  impurities_percent    Decimal              @db.Decimal(5, 2)
  impurities_discount   Decimal              @db.Decimal(12, 2)
  impurities_kg         Decimal              @db.Decimal(12, 2)
  weightLiq             Decimal              @db.Decimal(12, 2)
  cycleId               String?
  createdAt             DateTime             @default(now())
  updatedAt             DateTime             @updatedAt
  companyId             String
  document              String?
  truckDriver           String?
  product               ProductType
  adjust_kg             Decimal?             @db.Decimal(12, 2)
  tax_kg                Decimal?             @db.Decimal(12, 2)
  company               Company              @relation(fields: [companyId], references: [id])
  cycle                 ProductionCycle?     @relation(fields: [cycleId], references: [id])
  industryDeposit       IndustryDeposit      @relation(fields: [industryDepositId], references: [id], onDelete: Restrict)
  industryTransporter   IndustryTransporter? @relation(fields: [industryTransporterId], references: [id], onDelete: Restrict)
  talhao                Talhao               @relation(fields: [talhaoId], references: [id], onDelete: Restrict)
}

model IndustrySale {
  id                    String               @id @default(cuid())
  date                  DateTime             @default(now())
  document              String?
  product               ProductType
  industryDepositId     String
  customerId            String
  industryTransporterId String?
  truckPlate            String?
  truckDriver           String?
  weightBt              Decimal              @db.Decimal(12, 2)
  weightTr              Decimal              @db.Decimal(12, 2)
  weightSubLiq          Decimal              @db.Decimal(12, 2)
  discountsKg           Decimal?             @db.Decimal(12, 2)
  weightLiq             Decimal              @db.Decimal(12, 2)
  unitPrice             Float
  totalPrice            Float
  notes                 String?
  companyId             String
  cycleId               String?
  paymentCondition      PaymentCondition?
  dueDate               DateTime?
  createdAt             DateTime             @default(now())
  fileUrl               String?
  accountReceivable     AccountReceivable?
  company               Company              @relation(fields: [companyId], references: [id])
  customer              Customer             @relation(fields: [customerId], references: [id], onDelete: Restrict)
  cycle                 ProductionCycle?     @relation(fields: [cycleId], references: [id])
  industryDeposit       IndustryDeposit      @relation(fields: [industryDepositId], references: [id], onDelete: Restrict)
  industryTransporter   IndustryTransporter? @relation(fields: [industryTransporterId], references: [id], onDelete: Restrict)
}

model IndustryStockAdjustment {
  id                String          @id @default(cuid())
  date              DateTime
  quantityKg        Decimal         @db.Decimal(12, 2)
  product           ProductType
  industryDepositId String
  companyId         String
  notes             String?
  company           Company         @relation(fields: [companyId], references: [id])
  industryDeposit   IndustryDeposit @relation(fields: [industryDepositId], references: [id])
}


model Machine {
  id           String        @id @default(cuid())
  companyId    String
  name         String
  type         MachineType
  brand        String?
  model        String?
  plate        String?
  serialNumber String?
  hourmeter    Float         @default(0)
  odometer     Float         @default(0)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  company      Company       @relation(fields: [companyId], references: [id])
  maintenances Maintenance[]
  refuels      Refuel[]
}

model FuelTank {
  id        String         @id @default(cuid())
  companyId String
  name      String
  capacity  Float
  stock     Float          @default(0)
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  purchases FuelPurchase[]
  company   Company        @relation(fields: [companyId], references: [id])
  refuels   Refuel[]
}

model FuelPurchase {
  id               String            @id @default(cuid())
  companyId        String
  tankId           String
  customerId       String
  paymentCondition PaymentCondition?
  dueDate          DateTime?
  date             DateTime          @default(now())
  quantity         Float
  totalValue       Float
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  fileUrl          String?
  invoiceNumber    String?
  unitPrice        Float
  accountPayable   AccountPayable?
  company          Company           @relation(fields: [companyId], references: [id])
  customer         Customer          @relation(fields: [customerId], references: [id])
  tank             FuelTank          @relation(fields: [tankId], references: [id])
}

model Refuel {
  id        String   @id @default(cuid())
  companyId String
  tankId    String
  machineId String
  date      DateTime @default(now())
  quantity  Float
  hourmeter Float?
  odometer  Float?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  company   Company  @relation(fields: [companyId], references: [id])
  machine   Machine  @relation(fields: [machineId], references: [id])
  tank      FuelTank @relation(fields: [tankId], references: [id])
}

model Maintenance {
  id               String           @id @default(cuid())
  companyId        String
  machineId        String
  customerId       String
  paymentCondition PaymentCondition
  dueDate          DateTime?
  date             DateTime         @default(now())
  description      String
  totalValue       Float
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  accountPayable   AccountPayable?
  company          Company          @relation(fields: [companyId], references: [id])
  customer         Customer         @relation(fields: [customerId], references: [id])
  machine          Machine          @relation(fields: [machineId], references: [id])
}

enum Plan {
  BASIC
  PREMIUM
}

enum Role {
  ADMIN
  USER
}

enum ProductType {
  SOJA
  TRIGO
  MILHO
  AVEIA_BRANCA
  AVEIA_PRETA
  AVEIA_UCRANIANA
  AZEVEM
}

enum OperationType {
  Colheita
  Compra
  Descarte
  Venda
  Plantio
  Ajuste
}

enum CultivarStatus {
  BENEFICIANDO
  BENEFICIADO
}

enum ProductClass {
  ADUBO_DE_BASE
  ADUBO_DE_COBERTURA
  HERBICIDA
  INSETICIDA
  FUNGICIDA
  OLEO_MINERAL
  ADJUVANTE
  CORRETIVO
  OUTROS
}

enum Unit {
  KG
  GR
  L
  ML
  SC
  UN
  CX
  TN
}

enum InsumoOperationType {
  COMPRA
  TRANSFERENCIA
  APLICACAO
}

enum PaymentCondition {
  AVISTA
  APRAZO
}

enum AccountStatus {
  PENDING
  PAID
  OVERDUE
  CANCELED
}

enum MachineType {
  TRACTOR
  COMBINE
  SPRAYER
  TRUCK
  PICKUP
  IMPLEMENT
  OTHER
}
